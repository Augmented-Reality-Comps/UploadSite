<!doctype html>

<!-- File Upload Page by Michael Wheatman -->

<head>
  <meta charset="utf-8">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript">
  var uploaded_file;
  var files;
  if (window.File && window.FileReader && window.FileList) {
  // Great success! All the File APIs are supported.
} else {
  alert('The File APIs are not fully supported in this browser.');
}

  navigator.geolocation.getCurrentPosition(init_map);

  function init_map(position){

    var myOptions = {
      zoom:16,
      center:new google.maps.LatLng(position.coords.latitude.toPrecision(8),position.coords.longitude.toPrecision(8)),
      mapTypeId: google.maps.MapTypeId.SATELLITE
    };
    $('#lat').val(position.coords.latitude.toPrecision(8));
    $('#long').val(position.coords.longitude.toPrecision(8));
    map = new google.maps.Map(document.getElementById("gmap_canvas"), myOptions);
    google.maps.event.addListener(
      map, 'click', function(event) {
      $('#lat').val(event.latLng.lat().toPrecision(8));
      $('#long').val(event.latLng.lng().toPrecision(8));
      }
    );
  }

</script>
</head>
<h1>Augmented Reality - Object Creator</h1>
<div style="overflow:hidden;height:400px;width:500px;">
  <div id="gmap_canvas" style="height:400px;width:500px;"></div>
  <style>#gmap_canvas img {
      max-width:none!important;
      background:none!important
    }
  </style>
</div>
<style>
#drop_zone {
  border: 2px dashed #bbb;
  -moz-border-radius: 5px;
  -webkit-border-radius: 5px;
  border-radius: 5px;
  padding: 25px;
  text-align: center;
  font: 20pt bold 'Vollkorn';
  color: #bbb;
}
</style>
<form> <!-- action="accept_file_upload.py"> -->
  <table>
    <tr>
      <td>Latitude:</td>
      <td><input type="text" name="latitude" id="lat"></td>
      <td>Longitude:</td>
      <td><input type="text" name="longitude" id="long"></td>
    </tr>
  <tr>
    <td colspan="4">
      <!-- <input type="file" required="true"> -->
      <div id="drop_zone">Drop COLLADA file here</div>
      <output id="list"></output>
    </td>
  </tr>
  </table>
  <br>
  <input type="submit" value="Submit">
</form>
<script type="text/javascript">
  function testValidDAE() {
    uploaded_file = $('#collada').get(0).files[0];
    console.log(uploaded_file);
    //alert("changed File");
    //var parser = new DOMParser();
    //var doc = parser.parseFromString( fileAsString, "application/xml");
  }
</script>
<script>
  function handleFileSelect(evt) {
    evt.stopPropagation();
    evt.preventDefault();

    files = evt.dataTransfer.files; // FileList object.
    file = files[0];

    var reader = new FileReader();
    reader.readAsText(file);

    // files is a FileList of File objects. List some properties.
    var output = [];
    for (var i = 0, f; f = files[i]; i++) {
      output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                  f.size, ' bytes, last modified: ',
                  f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
                  '</li>');
    }
    document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
  }

  function handleDragOver(evt) {
    evt.stopPropagation();
    evt.preventDefault();
    evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
  }

  //Checks that file is valid COLLADA file before syncing with database
  function checkValidDAE(file){
    //<COLLADA xmlns="http://www.collada.org/2005/11/COLLADASchema" version="1.4.1">
  }

  //Stores coordinates + object into database
  function syncObjectDatabase(){
    //
  }


  // Setup the dnd listeners.
  var dropZone = document.getElementById('drop_zone');
  dropZone.addEventListener('dragover', handleDragOver, false);
  dropZone.addEventListener('drop', handleFileSelect, false);
</script>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
